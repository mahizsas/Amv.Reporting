@model DatabaseDetails

@{
    ViewBag.Title = "New Database Configuration";
}

<h2>New Database Configuration</h2>
@using (Html.BeginForm(MVC.Database.Create(), FormMethod.Post, new { role = "form" }))
{
    <div class="form-group">
        @Html.LabelFor(m => m.Name, new { @class = "control-label" })
        @Html.TextBoxFor(m => m.Name, new { @class = "form-control" })
        @Html.ValidationMessageFor(m => m.Name)
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.ConnectionString, new { @class = "control-label" })
        @Html.TextBoxFor(m => m.ConnectionString, new { @class = "form-control" })
        <a id="checkConnection">Check Connection</a> <span id="connectionCheckingResult"></span>
        @Html.ValidationMessageFor(m => m.ConnectionString)
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Description, new { @class = "control-label" })
        @Html.TextAreaFor(m => m.Description, new { @class = "form-control" })
        @Html.ValidationMessageFor(m => m.Description)
    </div>

    <div class="row">
        <div class="col-sm-2"></div>
        <input type="submit" value="Create" class="btn btn-default" />
        @Html.ActionLink("Back To List", MVC.Database.Index(), new { @class = "btn btn-default" })
    </div>
}

@section scripts
{
    <script type="text/javascript">
        $(document).ready(function() {
            $('#checkConnection').on('click', function() {
                var self = $(this);

                $.ajax({
                    type: 'POST',
                    url: '@Url.Action(MVC.Database.CheckDatabaseConnection())',
                    data: { connectionString: $('#ConnectionString').val() },
                    error: function() {
                        alert('Communication problem. Could not reach server.');
                    },
                    success: function(result) {
                        if (result.IsConnected) {
                            $('#connectionCheckingResult').html("OK")
                                .removeClass("red").addClass("green");
                        } else {
                            $('#connectionCheckingResult').html(result.ExceptionMessage)
                                .removeClass("green").addClass("red");
                        }
                    }
                });
            });
        });
    </script>
}
