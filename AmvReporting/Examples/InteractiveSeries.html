<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost Time Rate by Area</title>
    <link href="/Content/bootstrap.css" rel="stylesheet" />
    <link href="/Content/site.css" rel="stylesheet" />
    <link href="/Content/Datatables-1.9.4/media/css/jquery.dataTables.css" rel="stylesheet" />
    <link href="/Content/Datatables-1.9.4/media/css/jquery.dataTables_themeroller.css" rel="stylesheet" />
    <script src="/Scripts/modernizr-2.6.2.js"></script>
</head>
<body>
    
    <div class="container client-content">
        <h2>Lost Time Rate by Area</h2>
        <div class="row">
            <div class="col-md-8 graph-container">
                <div id="report" style="height: 600px;"></div>
            </div>
            <div class="col-md-4" id="choices"></div>
        </div>
    </div>


    <script src="/Scripts/jquery-1.10.2.js"></script>
    <script src="/Scripts/bootstrap.js"></script>
    <script src="/Scripts/respond.js"></script>
    <script src="/Scripts/DataTables-1.9.4/media/js/jquery.dataTables.min.js"></script>
    <script src="/Scripts/flot/jquery.flot.js"></script>
    <script src="/Scripts/flot/jquery.flot.categories.js"></script>

    <script type="text/javascript" language="javascript">
        jQuery.showAlert = function (message, alertLevel) {
            $('#alert-placeholder').html('<div class="in alert ' + alertLevel + '" id="alert-message"><a class="close" data-dismiss="alert">×</a><span>' + message + '</span></div>');
            window.setTimeout(function () {
                $("#alert-message").fadeTo(500, 0).slideUp(500, function () {
                    $(this).remove();
                });
            }, 3000);
        };

        jQuery.showWarning = function (message) {
            $.showAlert(message, 'alert-danger');
        };
        jQuery.showSuccess = function (message) {
            $.showAlert(message, 'alert-success');
        };
    </script>


    <script type="text/javascript">
        $(document).ready(function () {
            var columns = [
                {
                    "mData": "month",
                    "sTitle": "month"
                },
                {
                    "mData": "percentagelosttime",
                    "sTitle": "percentagelosttime"
                },
                {
                    "mData": "dept",
                    "sTitle": "dept"
                }
            ];
            var data = [
                {
                    "month": "April",
                    "percentagelosttime": "0.16",
                    "dept": "Corporate Services"
                },
                {
                    "month": "April",
                    "percentagelosttime": "2.32",
                    "dept": "Finance & Fundraising"
                },
                {
                    "month": "April",
                    "percentagelosttime": "0",
                    "dept": "Marketing & Enterprise"
                },
                {
                    "month": "April",
                    "percentagelosttime": "4.34",
                    "dept": "Operations"
                },
                {
                    "month": "April",
                    "percentagelosttime": "0.83",
                    "dept": "Senior Management Team"
                },
                {
                    "month": "May",
                    "percentagelosttime": "0.99",
                    "dept": "Corporate Services"
                },
                {
                    "month": "May",
                    "percentagelosttime": "1.54",
                    "dept": "Finance & Fundraising"
                },
                {
                    "month": "May",
                    "percentagelosttime": "0",
                    "dept": "Marketing & Enterprise"
                },
                {
                    "month": "May",
                    "percentagelosttime": "4.15",
                    "dept": "Operations"
                },
                {
                    "month": "May",
                    "percentagelosttime": "0.64",
                    "dept": "Senior Management Team"
                },
                {
                    "month": "June",
                    "percentagelosttime": "0.93",
                    "dept": "Corporate Services"
                },
                {
                    "month": "June",
                    "percentagelosttime": "1.61",
                    "dept": "Finance & Fundraising"
                },
                {
                    "month": "June",
                    "percentagelosttime": "0",
                    "dept": "Marketing & Enterprise"
                },
                {
                    "month": "June",
                    "percentagelosttime": "4.03",
                    "dept": "Operations"
                },
                {
                    "month": "June",
                    "percentagelosttime": "0.45",
                    "dept": "Senior Management Team"
                },
                {
                    "month": "July",
                    "percentagelosttime": "0.7",
                    "dept": "Corporate Services"
                },
                {
                    "month": "July",
                    "percentagelosttime": "1.65",
                    "dept": "Finance & Fundraising"
                },
                {
                    "month": "July",
                    "percentagelosttime": "2.28",
                    "dept": "Marketing & Enterprise"
                },
                {
                    "month": "July",
                    "percentagelosttime": "4.12",
                    "dept": "Operations"
                },
                {
                    "month": "July",
                    "percentagelosttime": "0.35",
                    "dept": "Senior Management Team"
                },
                {
                    "month": "August",
                    "percentagelosttime": "0",
                    "dept": "Corporate Relations & Fundraising"
                },
                {
                    "month": "August",
                    "percentagelosttime": "0.7",
                    "dept": "Corporate Services"
                },
                {
                    "month": "August",
                    "percentagelosttime": "0",
                    "dept": "Finance & Corporate Services"
                },
                {
                    "month": "August",
                    "percentagelosttime": "1.65",
                    "dept": "Finance & Fundraising"
                },
                {
                    "month": "August",
                    "percentagelosttime": "0",
                    "dept": "Human Resources and L & D"
                },
                {
                    "month": "August",
                    "percentagelosttime": "3.85",
                    "dept": "Marketing & Enterprise"
                },
                {
                    "month": "August",
                    "percentagelosttime": "4.18",
                    "dept": "Operations"
                },
                {
                    "month": "August",
                    "percentagelosttime": "0.28",
                    "dept": "Senior Management Team"
                },
                {
                    "month": "September",
                    "percentagelosttime": "0",
                    "dept": "Corporate Relations & Fundraising"
                },
                {
                    "month": "September",
                    "percentagelosttime": "0.7",
                    "dept": "Corporate Services"
                },
                {
                    "month": "September",
                    "percentagelosttime": "0.16",
                    "dept": "Finance & Corporate Services"
                },
                {
                    "month": "September",
                    "percentagelosttime": "1.65",
                    "dept": "Finance & Fundraising"
                },
                {
                    "month": "September",
                    "percentagelosttime": "0.34",
                    "dept": "Human Resources and L & D"
                },
                {
                    "month": "September",
                    "percentagelosttime": "4.35",
                    "dept": "Marketing & Enterprise"
                },
                {
                    "month": "September",
                    "percentagelosttime": "4.14",
                    "dept": "Operations"
                },
                {
                    "month": "September",
                    "percentagelosttime": "0.23",
                    "dept": "Senior Management Team"
                },
                {
                    "month": "October",
                    "percentagelosttime": "0",
                    "dept": "Corporate Relations & Fundraising"
                },
                {
                    "month": "October",
                    "percentagelosttime": "0.7",
                    "dept": "Corporate Services"
                },
                {
                    "month": "October",
                    "percentagelosttime": "1.15",
                    "dept": "Finance & Corporate Services"
                },
                {
                    "month": "October",
                    "percentagelosttime": "1.65",
                    "dept": "Finance & Fundraising"
                },
                {
                    "month": "October",
                    "percentagelosttime": "0.83",
                    "dept": "Human Resources and L & D"
                },
                {
                    "month": "October",
                    "percentagelosttime": "3.57",
                    "dept": "Marketing & Enterprise"
                },
                {
                    "month": "October",
                    "percentagelosttime": "4.21",
                    "dept": "Operations"
                },
                {
                    "month": "October",
                    "percentagelosttime": "0.26",
                    "dept": "Senior Management Team"
                }
            ];
            var datasets = {};
            data.map(function (row) {
                if (!(row.dept in datasets)) {
                    datasets[row.dept] = {
                        label: row.dept,
                        data: [row.month, row.percentagelosttime],
                    };
                } else {
                    datasets[row.dept].data.push([row.month, row.percentagelosttime]);
                }
            });

            //hard-code color indices to prevent them from shifting as series are turned on/off
            var i = 0;
            $.each(datasets, function (key, val) {
                val.color = i;
                ++i;
            });

            // insert checkboxes
            var choiceContainer = $("#choices");
            $.each(datasets, function (key, val) {
                choiceContainer.append("<br/><input type='checkbox' name='" + key +
                    "' checked='checked' id='id" + key + "'></input>" +
                    "<label for='id" + key + "'>"
                    + val.label + "</label>");
            });

            choiceContainer.find("input").click(plotAccordingToChoices);

            function plotAccordingToChoices() {

                var data = [];

                choiceContainer.find("input:checked").each(function () {
                    var key = $(this).attr("name");
                    if (key && datasets[key]) {
                        data.push(datasets[key]);
                    }
                });

                if (data.length > 0) {
                    $.plot("#report", data, {
                        xaxis: {
                            mode: "categories",
                        }
                    });
                }
            }

            plotAccordingToChoices();

        });
    </script>
</body>
</html>
