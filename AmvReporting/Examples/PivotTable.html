<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost Time Rate High Level Current Year</title>
    <link href="/Content/bootstrap.css" rel="stylesheet" />
    <link href="/Content/site.css" rel="stylesheet" />
    <link href="/Content/Datatables-1.9.4/media/css/jquery.dataTables.css" rel="stylesheet" />
    <link href="/Content/Datatables-1.9.4/media/css/jquery.dataTables_themeroller.css" rel="stylesheet" />

    <script src="/Scripts/jquery-1.10.2.js"></script>
    <script src="/Scripts/bootstrap.js"></script>
    <script src="/Scripts/respond.js"></script>
    <script src="/Scripts/DataTables-1.9.4/media/js/jquery.dataTables.min.js"></script>
</head>
<body>
    <div class="container client-content">
        <table id="report"></table>
    </div>

    <script type="text/javascript" language="javascript">

        jQuery.showAlert = function (message, alertLevel) {
            $('#alert-placeholder').html('<div class="in alert ' + alertLevel + '" id="alert-message"><a class="close" data-dismiss="alert">×</a><span>' + message + '</span></div>');
            window.setTimeout(function () {
                $("#alert-message").fadeTo(500, 0).slideUp(500, function () {
                    $(this).remove();
                });
            }, 5000);
        };

        jQuery.showWarning = function (message) {
            $.showAlert(message, 'alert-danger');
        };
        jQuery.showSuccess = function (message) {
            $.showAlert(message, 'alert-success');
        };


    </script>


    <script type="text/javascript">
        $(document).ready(function () {
            var data = [
                {
                    "NumYearMonth": "201302",
                    "Region": "Cornerstone Non-Regional Staff",
                    "Area": "Cornerstone Non-Regional Staff",
                    "Service": "Childrens Services Manager",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "Cornerstone Non-Regional Staff",
                    "Area": "Cornerstone Non-Regional Staff",
                    "Service": "Community Justice Services Manager",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "Cornerstone Non-Regional Staff",
                    "Area": "Cornerstone Non-Regional Staff",
                    "Service": "Employment Service West ESF",
                    "LostTimeRate": "204.68"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "Cornerstone Non-Regional Staff",
                    "Area": "Cornerstone Non-Regional Staff",
                    "Service": "Volunteer mgt & admin",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Borders",
                    "Service": "Borders CS",
                    "LostTimeRate": "1.29"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Borders",
                    "Service": "Lothian & Borders - Ops Mgrs",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Central - Admin",
                    "Service": "East - Office",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Central - Admin",
                    "Service": "East - split",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Balerno",
                    "LostTimeRate": "6.59"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Benvie",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Blackwood Court",
                    "LostTimeRate": "3.10"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Dundee Children's Service",
                    "LostTimeRate": "3.83"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Dundee City - Ops Mgt",
                    "LostTimeRate": "7.10"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Dundee CS",
                    "LostTimeRate": "14.33"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Dundee Flexible Support",
                    "LostTimeRate": "2.20"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Dundee Homecare",
                    "LostTimeRate": "3.71"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Dundee Relief",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Dundee Transitions Service",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Employment Service - East",
                    "LostTimeRate": "38.57"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Employment Service West ESF",
                    "LostTimeRate": "14.42"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Fairfield Road",
                    "LostTimeRate": "9.58"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Keswick",
                    "LostTimeRate": "0.30"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Quality Development Manager",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Rankine Street",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Springhill Gardens",
                    "LostTimeRate": "15.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Tayside - Admin",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "Victoria Street",
                    "LostTimeRate": "0.91"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Dundee City Operations",
                    "Service": "William Barclay Square",
                    "LostTimeRate": "0.50"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "East Lothian",
                    "Service": "East Lothian Children and Young Peoples Service",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "East Lothian",
                    "Service": "East Lothian CS",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Fife",
                    "Service": "Drum Road",
                    "LostTimeRate": "10.22"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Fife",
                    "Service": "Dundonald 18",
                    "LostTimeRate": "10.21"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Fife",
                    "Service": "Fife CS",
                    "LostTimeRate": "9.77"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Fife",
                    "Service": "Fife Flexi Team",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Fife",
                    "Service": "Fife Relief",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Bridgefoot",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Drum Road",
                    "LostTimeRate": "233.97"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Eden House",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Fife Relief",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Fife, Perth  & Kinross - Ops Mgrs",
                    "LostTimeRate": "0.96"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "New Row",
                    "LostTimeRate": "0.81"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Perth CS",
                    "LostTimeRate": "3.83"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Perth Direct Payment Support Service",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Perth Flexi Team",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Perth Relief",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Short Breaks & Respite Bureau",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Springbank Service",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "Perth & Kinross",
                    "Service": "Strathearn (Crieff)",
                    "LostTimeRate": "7.74"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "East of Scotland",
                    "Area": "West Lothian",
                    "Service": "Forrest Walk",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "North of Scotland",
                    "Area": "Aberdeen City",
                    "Service": "72 Stevenson Court",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "North of Scotland",
                    "Area": "Aberdeen City",
                    "Service": "74 Stevenson Court",
                    "LostTimeRate": "3.65"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "North of Scotland",
                    "Area": "Aberdeen City",
                    "Service": "Abbotswell Drive 1",
                    "LostTimeRate": "1.65"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "North of Scotland",
                    "Area": "Aberdeen City",
                    "Service": "Aberdeen - Ops Mgt",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "North of Scotland",
                    "Area": "Aberdeen City",
                    "Service": "Aberdeen City Relief",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "North of Scotland",
                    "Area": "Aberdeen City",
                    "Service": "Aberdeen CS",
                    "LostTimeRate": "3.34"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "North of Scotland",
                    "Area": "Aberdeen City",
                    "Service": "Aberdeen New Day Services",
                    "LostTimeRate": "0.00"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "North of Scotland",
                    "Area": "Aberdeen City",
                    "Service": "Altonrea Gardens 9/11",
                    "LostTimeRate": "7.97"
                },
                {
                    "NumYearMonth": "201302",
                    "Region": "North of Scotland",
                    "Area": "Aberdeen City",
                    "Service": "Birkhall Parade 233",
                    "LostTimeRate": "2.16"
                },
                             
            ];




            $.fn.PivotedTable = function (oOptions) {
                var pivotedData = {};
                var columnsDefinition = {};

                oOptions.data.map(function (row) {
                    var colTitle = row[oOptions.colTitleColumnName];
                    var rowTitle = row[oOptions.rowTitleColumnName];
                    var cellValue = row[oOptions.valueColumnName];

                    columnsDefinition[colTitle] = { 'mData': colTitle, 'sTitle': colTitle };

                    if (!pivotedData[rowTitle]) {
                        pivotedData[rowTitle] = {};
                    }

                    // add current row "key"
                    pivotedData[rowTitle][oOptions.rowTitleColumnName] = rowTitle;

                    // all additional columns to be displayed 
                    if (oOptions.extraRowData) {
                        for (var i = 0; i < oOptions.extraRowData.length; i++) {
                            pivotedData[rowTitle][oOptions.extraRowData[i]] = row[oOptions.extraRowData[i]];
                        }
                    }

                    // actual cell values
                    pivotedData[rowTitle][colTitle] = cellValue;
                });


                // transorm object of objects into array of objects
                var dataset = [];
                $.each(pivotedData, function (key, values) {
                    dataset.push(values);
                });


                // fill in the blanks
                for (var row in dataset) {
                    for (var column in columnsDefinition) {
                        if (!dataset[row][column]) {
                            dataset[row][column] = [];
                        }
                    }
                }


                // transform columns definition into array of objects
                var columns = [];
                columns.push({ 'mData': oOptions.rowTitleColumnName, 'sTitle': oOptions.rowTitleColumnName });
                if (oOptions.extraRowData) {
                    for (var i = 0; i < oOptions.extraRowData.length; i++) {
                        columns.push({ 'mData': oOptions.extraRowData[i], 'sTitle': oOptions.extraRowData[i] });
                    }
                }

                $.each(columnsDefinition, function (key, values) {
                    columns.push(values);
                });


                this.dataTable({
                    aaData: dataset,
                    aoColumns: columns,
                    iDisplayLength: 25
                });

            };




            $.fn.HighlightValuesOver = function (targetValue) {
                $(this).each(function () {
                    var $this = $(this);
                    var value = $this.html();
                    if (value > targetValue) {
                        $this.css("background-color", "#F2C2C2");
                    }
                });
            };


            var options = {
                data: data,
                colTitleColumnName: 'NumYearMonth',
                rowTitleColumnName: 'Service',
                extraRowData: ['Area', 'Region'],
                valueColumnName: 'LostTimeRate',
            };

            $('#report').PivotedTable(options);

            $('#report td').HighlightValuesOver(20);
        });
    </script>



</body>
</html>
